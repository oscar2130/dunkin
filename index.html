<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>ë˜í‚¨ ì¶œí‡´ê·¼ ê¸°ë¡</title>
        <style>
            body {
                font-family: 'Arial', sans-serif;
                background-color: #f4f7fc;
                color: #333;
                display: flex;
                justify-content: center;
                align-items: center;
                height: 100vh;
                margin: 0;
            }

            .container {
                background-color: #fff;
                border-radius: 8px;
                padding: 30px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                width: 100%;
                max-width: 400px;
                text-align: center;
            }

            h1 {
                font-size: 24px;
                color: #333;
                margin-bottom: 20px;
            }

            label {
                font-size: 16px;
                margin-bottom: 10px;
                display: block;
                color: #555;
            }

            select, button {
                width: 100%;
                padding: 12px;
                margin: 8px 0;
                border: 2px solid #ccc;
                border-radius: 5px;
                font-size: 16px;
                background-color: #f9f9f9;
                cursor: pointer;
                transition: 0.3s;
            }

            select:focus, button:focus {
                border-color: #5c6bc0;
                outline: none;
            }

            button {
                background-color: #5c6bc0;
                color: white;
                font-weight: bold;
            }

            button:hover {
                background-color: #3f4b8f;
            }

            button:active {
                background-color: #3a4581;
            }

            button:disabled {
                background-color: #d3d3d3;
                cursor: not-allowed;
            }

            .message {
                font-size: 14px;
                color: #888;
                margin-top: 15px;
            }

            .error-message {
                color: red;
                font-size: 16px;
                margin-top: 20px;
            }

            .error-message span {
                font-size: 20px;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ì¶œí‡´ê·¼ ê¸°ë¡ ì‹œìŠ¤í…œ</h1>
            <form id="attendance-form">
                <label for="name">ì´ë¦„ ì„ íƒ</label>
                <select id="name" required>
                    <option value="ê¶Œí˜œê²½">ê¶Œí˜œê²½</option>
                    <option value="ê¹€ì˜ˆì›">ê¹€ì˜ˆì›</option>
                    <option value="ê¶Œí˜œì€">ê¶Œí˜œì€</option>
                    <option value="í™ë‹¤ë¹ˆ">í™ë‹¤ë¹ˆ</option>
                    <option value="ê¹€ë„ì˜">ê¹€ë„ì˜</option>
                    <option value="ì„ì •ë¯¸">ì„ì •ë¯¸</option>
                    <option value="ê¹€ì§€ëª…">ê¹€ì§€ëª…</option>
                </select>

                <button type="button" onclick="checkIn()">ì¶œê·¼</button>
                <button type="button" onclick="checkOut()">í‡´ê·¼</button>
            </form>
            <div class="message">ì¶œê·¼/í‡´ê·¼ ë²„íŠ¼ì„ ëˆŒëŸ¬ ê¸°ë¡ì„ ë‚¨ê¸°ì„¸ìš”.</div>
            <div class="error-message" id="error-message"></div>
        </div>

        <script>
            const sheetUrl = "https://script.google.com/macros/s/AKfycbzZ-awL3P2VQghj8KElu-HTTAWViQLMl9kDTdL66vTzEJX1xCv9e9M2oyW-VOwOFazh/exec"; // êµ¬ê¸€ ì•± ìŠ¤í¬ë¦½íŠ¸ ì›¹ ì•± URL

            // ì¶œê·¼ ë²„íŠ¼ í´ë¦­ ì‹œ
            function checkIn() {
                const name = document.getElementById('name').value;
                const time = new Date().toISOString();
                checkLocation(name, time, "ì¶œê·¼");
            }

            // í‡´ê·¼ ë²„íŠ¼ í´ë¦­ ì‹œ
            function checkOut() {
                const name = document.getElementById('name').value;
                const time = new Date().toISOString();
                checkLocation(name, time, "í‡´ê·¼");
            }

            // ìœ„ì¹˜ë¥¼ í™•ì¸í•˜ê³ , 140m ì´ë‚´ì¼ ê²½ìš°ì—ë§Œ ì¶œí‡´ê·¼ ê¸°ë¡ì„ ë“±ë¡
            function checkLocation(name, time, action) {
                const errorMessageElement = document.getElementById("error-message");
                errorMessageElement.innerHTML = ""; // ì´ˆê¸°í™”

                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        const userLatitude = position.coords.latitude;
                        const userLongitude = position.coords.longitude;
                        
                        // ë‘ ì§€ì  ì‚¬ì´ì˜ ê±°ë¦¬ë¥¼ ê³„ì‚° (ë‹¨ìœ„: ë¯¸í„°)
                        const distance = getDistance(35.268738, 129.232112, userLatitude, userLongitude); // ë§¤ì¥ ìœ„ë„/ê²½ë„
                        
                        if (distance <= 140) {
                            sendData(action, name, time);
                        } else {
                            showError("ë§¤ì¥ê³¼ ê±°ë¦¬ê°€ ë„ˆë¬´ ë©‰ë‹ˆë‹¤. ğŸƒâ€â™‚ï¸ğŸš¶â€â™€ï¸", "red");
                        }
                    }, function(error) {
                        showError("ìœ„ì¹˜ ì •ë³´ê°€ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ í™œì„±í™”í•˜ì„¸ìš”! ğŸ“", "orange");
                    });
                } else {
                    showError("ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ğŸŒ", "blue");
                }
            }

            // ë‘ ì§€ì  ì‚¬ì´ì˜ ê±°ë¦¬ë¥¼ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜ (ë‹¨ìœ„: ë¯¸í„°)
            function getDistance(lat1, lon1, lat2, lon2) {
                const R = 6371e3; // ì§€êµ¬ ë°˜ì§€ë¦„ (ë¯¸í„° ë‹¨ìœ„)
                const Ï†1 = lat1 * Math.PI / 180;
                const Ï†2 = lat2 * Math.PI / 180;
                const Î”Ï† = (lat2 - lat1) * Math.PI / 180;
                const Î”Î» = (lon2 - lon1) * Math.PI / 180;

                const a = Math.sin(Î”Ï† / 2) * Math.sin(Î”Ï† / 2) +
                          Math.cos(Ï†1) * Math.cos(Ï†2) *
                          Math.sin(Î”Î» / 2) * Math.sin(Î”Î» / 2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

                return R * c; // ë¯¸í„° ë‹¨ìœ„ë¡œ ë°˜í™˜
            }

            // Google Apps Scriptë¡œ ë°ì´í„° ì „ì†¡
            function sendData(action, name, time) {
                const latitude = 35.268738;  // í˜„ì¬ ìœ„ì¹˜ ìœ„ë„
                const longitude = 129.232112; // í˜„ì¬ ìœ„ì¹˜ ê²½ë„

                // POST ìš”ì²­ì„ ì‚¬ìš©í•˜ì—¬ Google Apps Scriptì— ë°ì´í„° ì „ì†¡
                fetch(sheetUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: `name=${name}&action=${action}&latitude=${latitude}&longitude=${longitude}`
                })
                .then(response => response.text())
                .then(data => {
                    alert(action + " ì™„ë£Œ: " + data); // ì™„ë£Œ ì‹œ ì•Œë¦¼
                })
                .catch(error => {
                    console.error('Error:', error); // ì—ëŸ¬ ë°œìƒ ì‹œ ë¡œê·¸
                    showError("ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. âš ï¸", "red");
                });
            }

            // ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ í™”ë©´ì— ì¶œë ¥í•˜ëŠ” í•¨ìˆ˜
            function showError(message, color) {
                const errorMessageElement = document.getElementById("error-message");
                errorMessageElement.innerHTML = `<span style="color:${color};">${message}</span>`;
            }
        </script>
    </body>
</html>
